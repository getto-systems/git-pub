#!/bin/bash

git_sync_pub_main(){
  local branch
  local current

  branch=$1; shift

  if [ -z "$branch" ]; then
    echo "usage git-sync-pub <remote-branch>"
    exit 1
  fi

  current=$(git symbolic-ref --short HEAD)

  git checkout -b $branch && \
    git add -A . && \
    git fetch pub && \
    git merge pub/$branch && \
    git reset

  if [ $? != 0 ]; then
    git checkout $current && \
      git branch -d $branch && \
      git reset
  fi
}

git_sync_pub_main "$@"
